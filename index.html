<html>
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script>

        let numberArray = [];
        let cardpackJson =[
            {
                "id": "SV2a",
                "name": "스칼렛&바이올렛 강화 확장팩 「포켓몬 카드 151」",
                "imgCard": "https://cards.image.pokemonkorea.co.kr/data/wmimages/SV/SV2a/SV2a",
                "countCard": 165
            },
            {
                "id" : "SV2P",
                "name" : "스칼렛&바이올렛 확장팩 「스노해저드」",
                "imgCard" : "https://cards.image.pokemonkorea.co.kr/data/wmimages/SV/SV2P/SV2P",
                "countCard" : 96
            },
            {
                "id" : "SV2D",
                "name" : "스칼렛&바이올렛 확장팩 「클레이버스트」",
                "imgCard" : "https://cards.image.pokemonkorea.co.kr/data/wmimages/SV/SV2D/SV2D",
                "countCard" : 96
            }
        ];

        let baseImageUrl = "";

        // 배열 순서를 무작위로 섞기
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                let temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
            return array;
        }

        function initGame(idCard){

            let jsonObj = null;
            for (let i = 0; i < cardpackJson.length; i++) {
                if (cardpackJson[i].id === idCard) {
                    jsonObj = cardpackJson[i];
                    break;
                }
            }
            console.log(jsonObj);

            numberArray = [];

            for (let i = 1; i <= jsonObj.countCard; i++) {
                numberArray.push(i);
            }

            numberArray = shuffleArray(numberArray);
            baseImageUrl = jsonObj.imgCard;
            $("#cardTitle").text(jsonObj.name);
        }


        $(document).ready(function() {

            let card_back = "https://s3.amazonaws.com/ccg-corporate-production/news-images/_DSC002120210211142606865.JPG";
            $('.card').attr('src',card_back);


            $('.card').click(function(){

                if(numberArray.length == 0){
                    alert("모든 카드가 OPEN 되었습니다. 다른 카드팩을 열어보세요");
                    return;
                }

                if($(this).hasClass("closed") === true) {

                    let numCard = "" + numberArray.pop();
                    let imgCard = baseImageUrl + "_" + numCard.padStart(3, "0") + ".png?w=400";

                    console.log(imgCard);
                    $(this).addClass('animate__animated animate__bounce animate__delay-0.5s');
                    $(this).removeClass('closed');
                    $(this).addClass('opened');
                    $(this).attr('src', imgCard);
                }
            });

            $('#initGame').click(function(){
                $(".card").removeClass('animate__animated animate__bounce animate__delay-0.5s');
                $(".card").addClass('closed');
                $(".card").removeClass('opened');
                $(".card").removeClass('getted');
                $(".card").attr('src',card_back);
            });

            $('.cardpack').click(function(){
                let idCard = $(this).attr('id');
                initGame(idCard);
            });

            $('.getCard').click(function(){
                if($(this).prev().hasClass("opened") === true && $(this).prev().hasClass("getted") !== true) {
                    let divObj = "<div class='col p-3 col-lg-2 col-12'><image src='"+$(this).prev().attr('src')+"' class='rounded col-lg-12 col-12 p-3'></div>";
                    $('#myList').append(divObj);
                    $(this).prev().addClass("getted");
                }
            });
        });

    </script>
</head>
<body>
<div class="container px-4">
    <h1 class="border border-success rounded" style="margin: 10px;padding:10px;font-size: 2em">현성이의 포켓몬 카드게임이다!!</h1>
    <div class="row d-flex">
        <div id="carouselExampleControls" class="d-flex justify-content-center carousel slide align-self-center" data-bs-ride="carousel">
            <div class="carousel-inner w-100">
                <div class="carousel-item active">
                    <img src="https://data1.pokemonkorea.co.kr/2023/07/2023-07-24_19-49-34-75204-1690195774.png" id="SV2a" class="cardpack d-block w-100 img-fluid" alt="..."  data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                </div>
                <div class="carousel-item">
                    <img src="https://data1.pokemonkorea.co.kr/2023/06/2023-06-07_14-31-24-26167-1686115884.png" id="SV2P" class="cardpack d-block w-100 img-fluid" alt="..."  data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                </div>
                <div class="carousel-item">
                    <img src="https://data1.pokemonkorea.co.kr/2023/06/2023-06-07_14-03-41-77039-1686114221.png" id="SV2D" class="cardpack d-block w-100 img-fluid" alt="..."  data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev" style="background-color: black">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next" style="background-color: black">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    <div class="collapse"  id="collapseExample">
        <h3 id="cardTitle" class="rounded"></h3>
        <div class="row">
            <button id="initGame" type="button" class="btn btn-primary btn-lg">게임 시작</button>
        </div>
        <div class="row gx-5 d-flex justify-content-center">
            <div class="col p-3 col-lg-2 col-12">
                <img id="card01" class="card rounded closed col-lg-12 col-12">
                <button type="button" class="getCard btn btn-success  btn-lg col-lg-12 col-12" style="margin-top:10px">수집</button>
            </div>
            <div class="col p-3 col-lg-2 col-12 ">
                <img id="card02" class="card rounded closed col-lg-12 col-12">
                <button type="button" class="getCard btn btn-success  btn-lg col-lg-12 col-12" style="margin-top:10px">수집</button>
            </div>
            <div class="col p-3 col-lg-2 col-12 ">
                <img id="card03" class="card rounded closed col-lg-12 col-12">
                <button type="button" class="getCard btn btn-success  btn-lg col-lg-12 col-12" style="margin-top:10px">수집</button>
            </div>
            <div class="col p-3 col-lg-2 col-12 ">
                <img id="card04" class="card rounded closed col-lg-12 col-12">
                <button type="button" class="getCard btn btn-success btn-lg col-lg-12 col-12" style="margin-top:10px">수집</button>
            </div>
            <div class="col p-3 col-lg-2 col-12 ">
                <img id="card05" class="card rounded closed col-lg-12 col-12">
                <button type="button" class="getCard btn btn-success btn-lg col-lg-12 col-12" style="margin-top:10px">수집</button>
            </div>
        </div>
        <div class="row">
            <h3 style="margin: 20px;padding:10px">현성이의 카드 수집함</h3>
            <div class="row d-flex justify-content-center" id="myList">

            </div>
        </div>
    </div>
</div>
<div class="text-center"></div>
<input type="hidden">
</body>
</html>